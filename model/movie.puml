@startuml
package api{
    class OptionEngageApi{
        + engage(UserId userId)
    }
}
package service{

    class PremiumOptionEngageService{
    + void engage(UserId userId)
    }
    class NoticeService{
    + void send(Notification notification)
    }
}
OptionEngageApi .down.> PremiumOptionEngageService
PremiumOptionEngageService .right.> NoticeService
package domain{
package movie{

        class RegisteredUserEntity <<Entity>> {
            UserId userId
            RegistrationDate registrationDate
            Option<PremiumOption> premiumOption
            ContactAddress contactAddress
            Option<IntroductionCode> introductionCode

            + boolean canEngagePremiumOption()
            + Notification createNotification()
        }
        class UserId <<Key>>{
            String value
        }
        class RegistrationDate{
            LocalDate value
            + boolean isOneYearPassedSinceRegisterDate()
        }
        class PremiumOption{
            OptionNumber optionNumber
        }
        class OptionNumber{
            String value
        }
        interface ContactAddress{

        }
        class SMS {
            PhoneNumber phoneNumber
        }
        class PhoneNumber{
            String value
            + {static} NotificationTo createNotificationTo()
        }
        class Mail {
            MailAddress mailAddress
        }
        class MailAddress{
            String value
            + {static} NotificationTo createNotificationTo()
        }
        interface MovieUserRepository{
        + RegisteredUserEntity refer(UserId userId)
        + OptionNumber engagePremiumOption(UserId userId)
        }
        RegisteredUserEntity .down.> UserId
        RegisteredUserEntity .down.> RegistrationDate
        RegisteredUserEntity .down.> PremiumOption
        RegisteredUserEntity "1" o-- "0..1" PremiumOption
        RegisteredUserEntity .down.> ContactAddress
        ContactAddress .down.> SMS
        ContactAddress .down.> Mail
        SMS .down.> PhoneNumber
        Mail .down.> MailAddress
        PremiumOption .down.> OptionNumber
        }

    package notification{
            class Notification{
                NotificationTo notificationTo
                NotificationText notificationText
            }
            class NotificationTo {
                String value
            }

            class NotificationText {
                String value
            }

            interface NoticeRepository {
                + void send(Notification notification)
            }

            MailAddress .down.> NotificationTo
            PhoneNumber .down.> NotificationTo
            Notification .down.> NotificationTo
            Notification .down.> NotificationText
            RegisteredUserEntity .down.> Notification
        }

    package introduction_code{
        class IntroductionCode{
            PremiumOptionIntroductionCode premiumOptionIntroductionCode
            IntroductionCodeUseState introductionCodeUseState
        }
        class PremiumOptionIntroductionCode {
            String value
        }
        enum IntroductionCodeUseState{
            USE,
            UNUSED
            + boolean isUnused()
        }
    }


    MovieUserRepository .down.> UserId
    MovieUserRepository .down.> RegisteredUserEntity
    RegisteredUserEntity .down.> IntroductionCode
    RegisteredUserEntity "1" o-- "0..1" IntroductionCode
    IntroductionCode .down.> PremiumOptionIntroductionCode
    IntroductionCode .down.> IntroductionCodeUseState
}
PremiumOptionEngageService .down.> MovieUserRepository
NoticeService .down.> NoticeRepository

@enduml

